<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ECharts</title>

    <script src="./echarts.js"></script>
    <script src='./ecStataaa.js'></script>


    <style>
        canvas { border: 1px solid black; }



        .button_color {
        //background-color: #4CAF50; /* Green */
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            /*display: inline-block;*/
            font-size: 16px;
            cursor: pointer;
            /*float: left;*/
        }
        .button0 {
            background-color: #000000;
        }
        .button1 {
            background-color: #4CAF50;
        }
        .button2 {
            background-color: #008CBA;
        }
        .button3 {
            background-color: #b80af4;
        }
        .button4 {
            background-color: #ffffff;
        }
        .button0:hover {
            background-color: #808080;
        }
        .button1:hover {
            background-color: #808080;
        }
        .button2:hover {
            background-color: #808080;
        }
        .button3:hover {
            background-color: #808080;
        }


        .button4{color: black;}
        .button4:hover {
            background-color: #808080;
        }


    </style>



</head>
<body onload="initscatter()">
<!-- 为ECharts准备一个具备大小（宽高）的Dom -->
<div>
    <!--//id=1 2 3 直接用户数组小标 不用判断-->
    <button id="0" class="button_color button0" onclick="setcolorscatter(this)">Black</button>
    <button id="1" class="button_color button1" onclick="setcolorscatter(this)">Green</button>
    <button id="2" class="button_color button2" onclick="setcolorscatter(this)">Blue</button>
    <button id="3" class="button_color button3" onclick="setcolorscatter(this)">red</button>
    <button id="4" class="button_color button4" onclick="setcolorscatter(this)">打叉叉</button>

    <button id="5" onclick="clustering()">聚类</button>
    <button id="6" onclick="yiwanci()">一万次</button>
    <button id="8" onclick="dikaer()">笛卡尔</button>
    <button id="7" onclick="jizuobiao()">极坐标</button>
    <button id="7" onclick="daochu()">导出</button>


    <!--<button class="button">Button</button>-->
</div>

<div style="float:left">
    <div id="main" style="width: 600px;height:600px;"></div>
    <div style="float:left">
        <input type="range" id="myRange" value ="90" min="50" max="100" step="0.01" oninput="flitter()"/>
    </div>
    <div style="float:left">
        <p id="flitter">90.0%</p>
    </div>

<!--<button oninput="flitter()">flitter</button>-->

    <div style="clear:both">

            Xstart: <input type="text" id="x1" value="700"/>
            Xend: <input type="text" id="x2" value="800"/>
            <button id="7" class="change" onclick="changX()">改变X轴</button>
    </div>

    <div style="clear:both">

    Ystart: <input type="text" id="y1" value="700"/>
    Yend: <input type="text" id="y2" value="800"/>
    <button id="8" class="change" onclick="changY()">改变Y轴</button>
    </div>
</div>


<div style="float:left">
    <canvas id="bbb" width="800" height="600"></canvas>
</div>

<script type="text/javascript">


//------------------------------------------------------------



function changX()
{
    var x1=parseInt(document.getElementById("x1").value);
    var x2=parseInt(document.getElementById("x2").value);



    myChart.setOption({
        dataZoom: [{
           // type: 'value',
            xAxisIndex: 0,
            startValue: x1,
            endValue: x2
            //name:'FAM'

             },

            {
            // type: 'value',
            //yAxisIndex: 0,

            //name:'FAM'

        }


        ]
        })

}

function changY() {
    var y1 = parseInt(document.getElementById("y1").value);
    var y2 = parseInt(document.getElementById("y2").value);


    myChart.setOption({
        dataZoom: [
            {
                // type: 'value',
                //xAxisIndex: 0,

                //name:'FAM'

            },

            {
            // type: 'value',
            yAxisIndex: 0,
            startValue: y1,
            endValue: y2
            //name:'FAM'
            }


        ]
    })

}





function flitter() {
        var x = document.getElementById("myRange").value;

        document.getElementById("flitter").innerHTML = x+'%';

        quanlity=x;

        for(var n=0;n<96;n++){

            if (data[n][2]>0&&data[n][2]<5) {

                if (data[n][7] < quanlity / 100)     //判定阈值判断
                {
                    data[n][2] = 4;
                }
                else
                {
                    var maxnum = maxof3(data[n][4], data[n][5], data[n][6]);
                    data[n][2] = maxnum[0]+1;
                }

            }

        }

        refreshscatter();


    }




    var cishu=500;
    var quanlity=0.80;

    var zuobiaoxi=0; //目前选择的状态标记0表示笛卡尔 1表示极坐标


//------------------------一下是两个数组初始化datadikaer指向dikaer数组空间，datajizuobiao指向dikaer数组空间
//-------------------------坐标在初始化时候算死确定不用来回算，后面分组信息在单机按钮后相互转移


        var data=[];
        var datajizuobiao=[];
            var random = function (max){
                return ((Math.random()*max));
            };

       // 将数据装载到数组中
       //  for (var i = 0; i < 5; i++) {
       //      data.push([random(20)+10, random(20)+10,0,0,0,0,0,1]);
       //  };
       //  for (var i = 0; i < 24; i++) {
       //      data.push([random(50)+100, random(20)+10,5,0,0,0,0,1]);
       //  };
       //  for (var i = 0; i < 40; i++) {
       //      var a=random(100)
       //      data.push([random(20)+100, random(20)+100,5,0,0,0,0,1]);
       //  };
       //  for (var i = 0; i < 24; i++) {
       //      data.push([random(20)+10, random(100)+100,5,0,0,0,0,1]);
       //  };
       //  for (var i = 0; i < 3; i++) {
       //      data.push([random(100)+10, random(100)+10,5,0,0,0,0,1]);
       //  };


        var dataraw=[
            [0, 0.183428, 0.295806],
            [1, 0.169379, 0.280481],
            [2, 0.093631, 0.537424],
            [3, 0.076106, 0.495444],
            [4, 0.079775, 0.555282],
            [5, 0.073383, 0.50648],
            [6, 0.181075, 0.331318],
            [7, 0.16297, 0.29199],
            [8, 0.085686, 0.565355],
            [9, 0.079636, 0.509768],
            [10, 0.082421, 0.576656],
            [11, 0.081156, 0.513804],
            [12, 0.271696, 0.106992],
            [13, 0.244866, 0.093315],
            [14, 0.197779, 0.329847],
            [15, 0.180219, 0.290102],
            [16, 0.089477, 0.564881],
            [17, 0.092473, 0.49602],
            [18, 0.255824, 0.097145],
            [19, 0.210092, 0.082791],
            [20, 0.166219, 0.306277],
            [21, 0.175221, 0.269787],
            [22, 0.208141, 0.311291],
            [23, 0.218729, 0.258699],
            [24, 0.197106, 0.342774],
            [25, 0.184313, 0.33993],
            [26, 0.278612, 0.074825],
            [27, 0.278754, 0.063304],
            [28, 0.269922, 0.065947],
            [29, 0.260397, 0.066022],
            [30, 0.174208, 0.365615],
            [31, 0.167111, 0.367265],
            [32, 0.262209, 0.061907],
            [33, 0.280403, 0.0638],
            [34, 0.282525, 0.060101],
            [35, 0.295163, 0.064582],
            [36, 0.080125, 0.649558],
            [37, 0.077928, 0.660637],
            [38, 0.174753, 0.375899],
            [39, 0.196263, 0.37791],
            [40, 0.291797, 0.066111],
            [41, 0.289071, 0.070979],
            [42, 0.057522, 0.651461],
            [43, 0.037686, 0.663716],
            [44, 0.122867, 0.379282],
            [45, 0.157295, 0.390948],
            [46, 0.198892, 0.376161],
            [47, 0.246048, 0.406056],
            [48, 0.197673, 0.31776],
            [49, 0.164428, 0.278163],
            [50, 0.086771, 0.514352],
            [51, 0.08498, 0.4727],
            [52, 0.078515, 0.530385],
            [53, 0.077046, 0.480668],
            [54, 0.166304, 0.314848],
            [55, 0.158943, 0.283478],
            [56, 0.183451, 0.327197],
            [57, 0.170716, 0.279667],
            [58, 0.177915, 0.190263],
            [59, 0.159687, 0.138427],
            [60, 0.152833, 0.327634],
            [61, 0.141379, 0.29024],
            [62, 0.180297, 0.325103],
            [63, 0.156891, 0.283734],
            [64, 0.168458, 0.306984],
            [65, 0.146228, 0.249645],
            [66, 0.183833, 0.331283],
            [67, 0.156195, 0.288107],
            [68, 0.074189, 0.549223],
            [69, 0.07576, 0.500496],
            [70, 0.186935, 0.322117],
            [71, 0.210864, 0.275035],
            [72, 0.171464, 0.336697],
            [73, 0.187553, 0.358671],
            [74, 0.248256, 0.0662],
            [75, 0.257143, 0.066439],
            [76, 0.251083, 0.055473],
            [77, 0.249017, 0.069348],
            [78, 0.16273, 0.354955],
            [79, 0.167061, 0.373],
            [80, 0.170666, 0.374696],
            [81, 0.168248, 0.375585],
            [82, 0.110302, 0.484714],
            [83, 0.013352, 0.605501],
            [84, 0.144591, 0.363885],
            [85, 0.170364, 0.381338],
            [86, 0.17518, 0.36813],
            [87, 0.176402, 0.381184],
            [88, 0.129802, 0.34817],
            [89, 0.162175, 0.369369],
            [90, 0.169712, 0.369798],
            [91, 0.169176, 0.373521],
            [92, 0.274128, 0.07299],
            [93, 0.276325, 0.074552],
            [94, 0.183252, 0.380812],
            [95, 0.239911, 0.41517],
            [96, 0.287665, 0.090878],
            [97, 0.252121, 0.090324],
            [98, 0.173417, 0.304201],
            [99, 0.148568, 0.266258],
            [100, 0.154343, 0.290966],
            [101, 0.126319, 0.226996],
            [102, 0.153638, 0.299586],
            [103, 0.141888, 0.269415],
            [104, 0.067148, 0.53562],
            [105, 0.070899, 0.476362],
            [106, 0.204856, 0.0991],
            [107, 0.166355, 0.082325],
            [108, 0.159872, 0.331203],
            [109, 0.140904, 0.277068],
            [110, 0.163155, 0.305287],
            [111, 0.143525, 0.244067],
            [112, 0.238713, 0.103842],
            [113, 0.212175, 0.094947],
            [114, 0.251143, 0.099327],
            [115, 0.233209, 0.101083],
            [116, 0.165273, 0.304896],
            [117, 0.149933, 0.256098],
            [118, 0.193398, 0.313429],
            [119, 0.184121, 0.279188],
            [120, 0.09035, 0.602211],
            [121, 0.084243, 0.608942],
            [122, 0.170927, 0.343411],
            [123, 0.173172, 0.364739],
            [124, 0.157117, 0.341074],
            [125, 0.156662, 0.344565],
            [126, 0.155573, 0.338575],
            [127, 0.167528, 0.352028],
            [128, 0.24976, 0.068233],
            [129, 0.253034, 0.070016],
            [130, 0.079976, 0.597007],
            [131, 0.07871, 0.643663],
            [132, 0.167908, 0.389914],
            [133, 0.167602, 0.387393],
            [134, 0.157891, 0.387486],
            [135, 0.161937, 0.397304],
            [136, 0.085157, 0.658412],
            [137, 0.07907, 0.641769],
            [138, 0.114736, 0.655307],
            [139, 0.07835, 0.657639],
            [140, 0.154138, 0.401152],
            [141, 0.165753, 0.403004],
            [142, 0.188958, 0.411698],
            [143, 0.219097, 0.414671],
            [144, 0.172325, 0.307332],
            [145, 0.194233, 0.276831],
            [146, 0.082764, 0.533879],
            [147, 0.080488, 0.476437],
            [148, 0.154992, 0.308777],
            [149, 0.142257, 0.253005],
            [150, 0.220134, 0.09127],
            [151, 0.180075, 0.080298],
            [152, 0.237017, 0.095471],
            [153, 0.205131, 0.083431],
            [154, 0.066241, 0.560213],
            [155, 0.071602, 0.507922],
            [156, 0.068659, 0.562213],
            [157, 0.063996, 0.507717],
            [158, 0.067589, 0.55998],
            [159, 0.064275, 0.503324],
            [160, 0.037627, 0.280282],
            [161, 0.03553, 0.095412],
            [162, 0.075781, 0.568744],
            [163, 0.076539, 0.497272],
            [164, 0.061794, 0.545927],
            [165, 0.078243, 0.500762],
            [166, 0.173222, 0.329667],
            [167, 0.187457, 0.303802],
            [168, 0.192145, 0.358955],
            [169, 0.209476, 0.353148],
            [170, 0.247725, 0.081242],
            [171, 0.242032, 0.070676],
            [172, 0.163275, 0.350768],
            [173, 0.157226, 0.357723],
            [174, 0.061836, 0.568025],
            [175, 0.059731, 0.599421],
            [176, 0.071103, 0.590142],
            [177, 0.062088, 0.620513],
            [178, 0.252515, 0.076411],
            [179, 0.269891, 0.076491],
            [180, 0.255953, 0.074654],
            [181, 0.26092, 0.074186],
            [182, 0.24746, 0.064743],
            [183, 0.25568, 0.063499],
            [184, 0.04329, 0.118516],
            [185, 0.044719, 0.029722],
            [186, 0.240668, 0.086623],
            [187, 0.25884, 0.0857],
            [188, 0.2603, 0.073183],
            [189, 0.28367, 0.090932],
            [190, 0.166594, 0.390002],
            [191, 0.227198, 0.432869],
            [192, 0.248397, 0.098667],
            [193, 0.225906, 0.096682],
            [194, 0.090402, 0.527651],
            [195, 0.08307, 0.486364],
            [196, 0.166347, 0.313806],
            [197, 0.144575, 0.2701],
            [198, 0.065451, 0.527752],
            [199, 0.076579, 0.47849],
            [200, 0.225981, 0.110202],
            [201, 0.199413, 0.090321],
            [202, 0.163222, 0.320297],
            [203, 0.157459, 0.284356],
            [204, 0.077298, 0.543678],
            [205, 0.076123, 0.470938],
            [206, 0.246851, 0.095168],
            [207, 0.212358, 0.090109],
            [208, 0.06868, 0.534527],
            [209, 0.077985, 0.457787],
            [210, 0.076161, 0.538004],
            [211, 0.079607, 0.464747],
            [212, 0.159462, 0.29968],
            [213, 0.146272, 0.239838],
            [214, 0.160992, 0.284055],
            [215, 0.18621, 0.286072],
            [216, 0.107395, 0.61413],
            [217, 0.100141, 0.605322],
            [218, 0.244111, 0.08056],
            [219, 0.249638, 0.070969],
            [220, 0.152123, 0.353591],
            [221, 0.171484, 0.38022],
            [222, 0.250789, 0.082884],
            [223, 0.262267, 0.081507],
            [224, 0.084178, 0.591986],
            [225, 0.075573, 0.61647],
            [226, 0.162524, 0.378144],
            [227, 0.180348, 0.379061],
            [228, 0.260631, 0.0749],
            [229, 0.255207, 0.071056],
            [230, 0.075164, 0.613988],
            [231, 0.070889, 0.644259],
            [232, 0.233126, 0.085401],
            [233, 0.254938, 0.07966],
            [234, 0.253369, 0.074773],
            [235, 0.247673, 0.074455],
            [236, 0.164825, 0.380361],
            [237, 0.165907, 0.369292],
            [238, 0.214969, 0.420026],
            [239, 0.257377, 0.437222],
            [240, 0.186054, 0.315047],
            [241, 0.177721, 0.299135],
            [242, 0.193956, 0.319555],
            [243, 0.169199, 0.284658],
            [244, 0.071745, 0.541643],
            [245, 0.071012, 0.495228],
            [246, 0.186855, 0.328432],
            [247, 0.168317, 0.298325],
            [248, 0.250413, 0.109992],
            [249, 0.227947, 0.107552],
            [250, 0.072035, 0.561234],
            [251, 0.076643, 0.503702],
            [252, 0.176437, 0.319298],
            [253, 0.162761, 0.285589],
            [254, 0.165163, 0.318524],
            [255, 0.147092, 0.287442],
            [256, 0.065252, 0.548223],
            [257, 0.064078, 0.498543],
            [258, 0.167136, 0.322967],
            [259, 0.147964, 0.281599],
            [260, 0.249156, 0.100421],
            [261, 0.215003, 0.089225],
            [262, 0.162096, 0.289229],
            [263, 0.182882, 0.254116],
            [264, 0.216219, 0.360534],
            [265, 0.2046, 0.384209],
            [266, 0.20336, 0.362115],
            [267, 0.199867, 0.378323],
            [268, 0.281817, 0.074496],
            [269, 0.289232, 0.081583],
            [270, 0.192317, 0.368294],
            [271, 0.198651, 0.381303],
            [272, 0.089279, 0.65425],
            [273, 0.081325, 0.65166],
            [274, 0.279393, 0.074709],
            [275, 0.299898, 0.065959],
            [276, 0.199508, 0.382424],
            [277, 0.200393, 0.389563],
            [278, 0.187466, 0.364282],
            [279, 0.183619, 0.370241],
            [280, 0.251862, 0.079521],
            [281, 0.269922, 0.081551],
            [282, 0.160868, 0.36411],
            [283, 0.168258, 0.378479],
            [284, 0.070665, 0.663904],
            [285, 0.077825, 0.639443],
            [286, 0.186746, 0.367294],
            [287, 0.22084, 0.393032],
            [288, 0.200094, 0.306592],
            [289, 0.177636, 0.26244],
            [290, 0.196424, 0.324723],
            [291, 0.184182, 0.286335],
            [292, 0.104037, 0.553408],
            [293, 0.102983, 0.48909],
            [294, 0.198793, 0.32583],
            [295, 0.188099, 0.308057],
            [296, 0.208715, 0.348665],
            [297, 0.188227, 0.308192],
            [298, 0.282075, 0.108841],
            [299, 0.260766, 0.098862],
            [300, 0.278881, 0.106776],
            [301, 0.249076, 0.09995],
            [302, 0.087834, 0.563024],
            [303, 0.078241, 0.490733],
            [304, 0.093914, 0.531777],
            [305, 0.082534, 0.441933],
            [306, 0.163233, 0.299269],
            [307, 0.148633, 0.237432],
            [308, 0.182725, 0.310721],
            [309, 0.167722, 0.248886],
            [310, 0.258142, 0.10401],
            [311, 0.250664, 0.081254],
            [312, 0.202107, 0.342224],
            [313, 0.2038, 0.351202],
            [314, 0.21084, 0.356162],
            [315, 0.214549, 0.37342],
            [316, 0.309344, 0.083776],
            [317, 0.305838, 0.084273],
            [318, 0.224388, 0.376667],
            [319, 0.22596, 0.378815],
            [320, 0.226881, 0.389406],
            [321, 0.230968, 0.399389],
            [322, 0.108837, 0.652947],
            [323, 0.105397, 0.683019],
            [324, 0.096546, 0.682402],
            [325, 0.119126, 0.666901],
            [326, 0.298462, 0.082805],
            [327, 0.306473, 0.073542],
            [328, 0.270929, 0.076507],
            [329, 0.285871, 0.079245],
            [330, 0.170854, 0.375308],
            [331, 0.189018, 0.390792],
            [332, 0.190836, 0.381006],
            [333, 0.207369, 0.403758],
            [334, 0.127713, 0.626805],
            [335, 0.13127, 0.65628],
            [336, 0.199203, 0.291233],
            [337, 0.187413, 0.256536],
            [338, 0.268481, 0.098535],
            [339, 0.240161, 0.090273],
            [340, 0.106511, 0.548184],
            [341, 0.109972, 0.480632],
            [342, 0.22726, 0.342804],
            [343, 0.21316, 0.312136],
            [344, 0.225299, 0.341617],
            [345, 0.213118, 0.308163],
            [346, 0.12051, 0.584385],
            [347, 0.118604, 0.536269],
            [348, 0.111901, 0.587823],
            [349, 0.113649, 0.534066],
            [350, 0.29498, 0.112884],
            [351, 0.27569, 0.104321],
            [352, 0.114667, 0.559535],
            [353, 0.107402, 0.500744],
            [354, 0.282912, 0.109222],
            [355, 0.263117, 0.094843],
            [356, 0.300992, 0.109436],
            [357, 0.271783, 0.095731],
            [358, 0.146599, 0.547063],
            [359, 0.141037, 0.493752],
            [360, 0.223925, 0.338857],
            [361, 0.219439, 0.357932],
            [362, 0.149464, 0.587073],
            [363, 0.152446, 0.609082],
            [364, 0.316894, 0.075061],
            [365, 0.332074, 0.069679],
            [366, 0.251473, 0.376794],
            [367, 0.254968, 0.39298],
            [368, 0.251936, 0.380783],
            [369, 0.256005, 0.385792],
            [370, 0.35099, 0.069795],
            [371, 0.352948, 0.069877],
            [372, 0.349013, 0.068709],
            [373, 0.367208, 0.076632],
            [374, 0.13178, 0.658939],
            [375, 0.126844, 0.672709],
            [376, 0.35499, 0.08076],
            [377, 0.339256, 0.071075],
            [378, 0.123386, 0.674866],
            [379, 0.130616, 0.68502],
            [380, 0.132247, 0.699712],
            [381, 0.136275, 0.693541],
            [382, 0.363947, 0.085104],
            [383, 0.388233, 0.071423]
        ];



        for (var a=0;a<dataraw.length;a++)
        {
            if((Math.floor(a/24))%2==1&&(a%24)%2==0)
                data.push([dataraw[a][1],dataraw[a][2],5,0,0,0,0,1]);



        }








        // for ( i = 0; i < 4; i++) {
        //     data.push([random(990), random(990),5,0,0,0,0,1,0]);
        // };

        var datadikaer =data;       //datadikaer初始化

        for (var i=0;i<datadikaer.length;i++)    //datajizuobiao初始化
        {
            r=Math.log10((Math.sqrt(datadikaer[i][0]*datadikaer[i][0]+datadikaer[i][1]*datadikaer[i][1])));
            therta=Math.atan(datadikaer[i][1]/datadikaer[i][0]);

            datajizuobiao.push([r,therta,datadikaer[i][2],datadikaer[i][3],datadikaer[i][4],datadikaer[i][5],datadikaer[i][6],datadikaer[i][7]]);

        }


        function daochu() {






        }

        function jizuobiao()
        {
            if (zuobiaoxi==0)
            {
                zuobiaoxi=1;

                selected=[];  //选择清空

                for (var i = 0; i < datadikaer.length; i++) {
                    for (var j = 2; j < 9; j++)

                        datajizuobiao[i][j] = datadikaer[i][j];

                }

                data = datajizuobiao;      //data指向极坐标

                refreshscatter();
            }


        }

        function dikaer()
        {
            if(zuobiaoxi==1) {

        zuobiaoxi=0;
                selected=[];  //选择清空
                for (var i = 0; i < datadikaer.length; i++) {
                    for (var j = 2; j < 9; j++)

                        datadikaer[i][j] = datajizuobiao[i][j];

                }

                data = datadikaer;   //data指向笛卡尔

                refreshscatter();
            }
        }











        // 基于准备好的dom，初始化echarts实例

        // var data = [];//数据区域缩放组件
        var fenzu=[[],[],[],[]];
        var zhuadaode=[[],[],[],[]];

        var myChart = echarts.init(document.getElementById('main'));

        // function savepic()
        // {
        //     //  var img = new Image();
        //     varaaa = myChart.getDataURL({
        //         type:'jpeg',
        //         pixelRatio: 1,
        //         //backgroundColor: '#fff'
        //         excludeComponents: ['toolbox']
        //     });



         //   }






        var selectchange =1;
        var deepcopy=[];


        function maxof3 (a,b,c)
        {
            var max=a,num=0;
            if (max<b) {
                max = b;
                num=1;
            }
            if (max<c) {
                max = c;
                num=2;
            }


            return [num,max]


        }
    //------------------------聚类一万次---------------------------


        function yiwanci()
    {



//清空
        for(var n=0;n<96;n++){


            data[n][3]=data[n][4]=data[n][5]=data[n][6]=data[n][7]=0;
           //黑色

        }




        for(var i=0;i<cishu;i++)
        {



            clustering();

            for(var n=0;n<96;n++){

             //   if(data[n][2]>0&&data[n][2]<5)
                data[n][data[n][2]+3]++;

            }

        }


         for(var n=0;n<96;n++){
        //


             if(data[n][2]>0) {

                 var maxnum = maxof3(data[n][4], data[n][5], data[n][6]);
                 data[n][2] = maxnum[0] + 1;
                 data[n][7] = maxnum[1] / cishu;

                 if (data[n][7] < quanlity)     //判定阈值判断
                     data[n][2] = 4;
             }



        }





        flitter();

        //refreshscatter();


    }






        var result;
        var ordercentroids=[];
        var nnn=0;

//--------------------聚类!!!!!!!!!!!!!!!!!!!!!!!!!-3类----------------------------------------

        function clustering() {

            var count = 0;

            console.log('clustering');
            var clusterNumber = 3;
            var dataclustering=[];//清空


            //采集需要聚类的点放入dataclustering

            // if(zuobiaoxi==0)
            // {
            //     data=datadikaer;
            //
            // }
            // else
            //     if(zuobiaoxi==1)
            //     {
            //         data=datajizuobiao
            //
            //     }
            //


            for (var i=0;i<data.length;i++)
            {
                if(data[i][2]>0)
                    dataclustering.push([data[i][0]*1000,data[i][1]*1000,i]); //放大一千倍放进去聚类
            }



//console.log("stop");

            result = ecStat.clustering.hierarchicalKMeans(dataclustering, clusterNumber, false);

//有时候分出来不是四个组很奇怪。


            // for (var a = 0; a < result.centroids.length; a++) {
            //     if (result.centroids[a].length > 0)
            //         count++;
            //
            // }

            // if (count<4)
            //     n++;

            //console.log(count);

            // if (count<3)    //变态的是 测试了很久很久 这个kmean聚类返回的结果可能不是4类 我也是醉了 小于3重来
            // {
            //     clustering();
            //
            // }

            //----------------------------一下才是3组的处理内容
//             else
//             {
//
//
                ordercentroids = [
                    [result.centroids[0][1]/result.centroids[0][0],0],
                    [result.centroids[1][1]/result.centroids[1][0],1],
                    [result.centroids[2][1]/result.centroids[2][0],2]
                  //  [result.centroids[3][0], result.centroids[3][1]]

                ];  //复制出来加一位



                //
                //=---------------------排序

                ordercentroids.sort(function (a, b) {
                    return b[0]-a[0];
                });                            //按照x坐标排序 序号记录进入第四位


                for (var i = 0; i < ordercentroids.length; i++)  //加一位 插入原始序号

                {
                    ordercentroids[i].push(i);  //排序后序号

                }
//
//
                ordercentroids.sort(function (a, b) {
                    return a[1]-b[1];
                });                                              //在排回去





//                 if (ordercentroids[0][1] > ordercentroids[1][1]) {
//                     ordercentroids[0][3] = 1;
//                     ordercentroids[1][3] = 0;
//
//                 }
//
//
//                 if (ordercentroids[2][1] > ordercentroids[3][1]) {
//                     ordercentroids[2][3] = 3;
//                     ordercentroids[3][3] = 2;
//
//                 }
//
// //-----------------以下这个循环不是人类可以理解的 如果正确了 那么分组将按照顺序赋值给原始数据的分组项
//                 //-----------------如果错了 我也想不出来怎么调试了 但是不幸的是 他对了
//
//
//
//
//                 for (var i = 0; i < 96; i++) {
//
//                     //         console.log(result.clusterAssment[i][0]);
//
//                     //        data[i][2]=result.clusterAssment[i][0];
//
//
//                     for (var n = 0; n < ordercentroids.length; n++) {
//                         if (result.clusterAssment[i][0] === ordercentroids[n][2]) {
//                             data[i][2] = ordercentroids[n][3]
//                         }
//
//                     }
//
//                 }

//-----------------------------------------------------------------------------
//                else

            for (var n = 0; n < dataclustering.length; n++)                   //逆天的操作啊
            {
                data[dataclustering[n][2]][2]=ordercentroids[result.clusterAssment[n][0]][2]+1;   //分组的颜色直接染给对应的data

            }


                colorscattortopanel();


                refreshscatter();
                refreshpanel();
             //   console.log(nnn++);





        }

        function initscatter()
        {

            //构造随机数
            // var random = function (max){
            //     return ((Math.random()*max));
            // };

            //将数据装载到数组中
            // for (var i = 0; i < 25; i++) {
            //     data.push([random(99), random(99),0]);
            // };
            //
            // for ( i = 25; i < 50; i++) {
            //     data.push([random(99), random(99),1]);
            // };
            //
            // for ( i = 50; i < 75; i++) {
            //     data.push([random(99), random(99),2]);
            // };
            //
            // for ( i = 75; i < 100; i++) {
            //     data.push([random(99), random(99),3]);
            // };

            refreshscatter();


            initcanvaspanel();

        }

        function refreshscatter(){

//console.log('refresh');
            //myChart.clear();
                  //0  1  2  3  4   5   6
                  //b  g  b  r  x   n   s
            fenzu=[[],[],[], [],[],[], []];

           // var select=[];

            for (var i = 0; i < 96; i++){
                fenzu[data[i][2]].push([data[i][0],data[i][1],i]);  //i表示在原数组中的位置
            }




            option = {

                tooltip : {
                    // padding: 10,
                    trigger: 'item',
                    //trigger: 'axis',
                    axisPointer: {
                        type: 'cross'

                    },
                    formatter: '{b}',
                },

                toolbox: {
                    left: 'right',
                    itemSize: 25,
                    top: 5,
                    feature: {
                        myTool1: {
                            show: true,
                            title: '保存图片',
                            icon: 'image://http://echarts.baidu.com/images/favicon.png',
                            //onclick: savepic()


                        },

                        // brush:{
                        //     type: 'rect',
                        //
                        // },
                        //
                        // brush:{
                        //     type: 'polygon',
                        //
                        // },

                        dataZoom: {

                        },



                        //
                        //
                        // myTool2: {
                        //     show: true,
                        //     title: '设置Y轴',
                        //     icon: 'image://http://echarts.baidu.com/images/favicon.png',
                        //     onclick: function () {
                        //         alert('myToolHandler2')
                        //     }
                        //
                        // },


                        restore: {},




                    },

                },



                brush:
                    {
                        toolbox:['rect','polygon','clear'],

                        brushType: 'rect',


                        romoveOnClick:'signle'    //单击空白处清空选择
                    },


                xAxis: [{
                    type: 'value',
                    scale: true,
                    min: function(value) {
                        return value.min-(value.max-value.min)*0.1 ;
                    },
                   max: function(value) {
                       return value.max+(value.max-value.min)*0.1 ;
                   },
                    name:'FAM',
                    nameLocation: 'center',
                    nameGap: 20,
                    nameTextStyle: {



                        fontSize: 18,

                        // verticalAlign: ...,
                        // lineHeight: ...,

                    }
                }]
                ,


                yAxis:
                    {
                        type: 'value',
                        scale: true,
                        min: function(value) {
                            return value.min-(value.max-value.min)*0.1 ;
                        },
                        max: function(value) {
                            return value.max+(value.max-value.min)*0.1;
                        },
                        name:'HEX',
                        nameLocation: 'center',
                        nameGap: 20,
                        nameTextStyle: {


                            fontSize: 18,

                            // verticalAlign: ...,
                            // lineHeight: ...,

                        }
                    }
                ,


                dataZoom: [
                    // 这个dataZoom组件，也控制y轴。


                    {   // 这个dataZoom组件，也控制x轴。
                        type: 'inside', // 这个 dataZoom 组件是 inside 型 dataZoom 组件
                        xAxisIndex: 0,
                        filterMode: 'empty',
                         // start: 10,      // 左边在 10% 的位置。
                         // end: 110         // 右边在 60% 的位置。
                    },
                    {
                        type: 'inside',
                        yAxisIndex: 0,
                        filterMode: 'empty',
                         // start: 10,
                         // end: 110
                    }


                ],


                series: [

                    {
                        animation: false,
                        name: 'black',
                        type: 'scatter',
                        symbolSize: 10,
                        z:'0',

                        data: fenzu[0],
                        itemStyle: {
                            color: '#000000'
                        },
                        symbol:'rect',

                    },


                    {
                        animation: false,
                        name:'green',
                        type: 'scatter',
                        symbolSize: 10,
                        z:'0',

                        data: fenzu[1],


                        itemStyle: {
                            color: '#4caf50'
                        }


                    },

                    {
                        animation: false,
                        name: 'blue',
                        type: 'scatter',
                        symbolSize: 10,
                        z:'0',

                        data: fenzu[2],


                        itemStyle: {
                            color: '#008cba'
                        },

                     //   symbol:'rect',

                    },

                    {
                        animation: false,
                        name:'red',
                        type: 'scatter',
                        symbolSize: 10,
                        z:'0',

                        data: fenzu[3],


                        itemStyle: {
                            color: '#b80af4'
                        },
                    //    symbol: 'triangle'


                    },


                    {
                        animation: false,
                        name: 'chacha',
                        type: 'scatter',
                        symbolSize: 10,
                        z: '0',

                        data: fenzu[4],


                        itemStyle: {
                            color: '#ff1736'
                        },

                        symbol: 'triangle'


                    },

                    {
                        animation: false,
                        name: 'none',
                        type: 'scatter',
                        symbolSize: 10,
                        z: '0',

                        data: fenzu[5],


                        itemStyle: {
                            color: '#787878'
                        },

                   //     symbol: 'triangle'


                    },

                    {
                        animation: false,
                        name: 'select',
                        type: 'scatter',
                        symbolSize: 20,
                        z: '0',

                        data: selected,


                        itemStyle: {
                            color: '#19f8ff',

                            opacity: 0.6


                        },

                       //symbol: 'rect'



                    }


                ]
            };



            // 使用刚指定的配置项和数据显示图表。
            myChart.setOption(option);


        }



myChart.on('brush', function ()          //这个事件用来出发清除panel选框
{


    hahaha=[
        [0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0]


    ];







});




        myChart.on('brushSelected', function (params) {
            //var brushComponent = params.batch[0];

            //var sum = 0; // 统计选中项的数据值的和
           // var xuhao;


            selectchange=1;
            zhuadaode=params.batch[0];
            deepcopy=[];


          //  selected=[];
   //         refreshscatter();


            console.log('hahaha');
            for (var sIdx = 0; sIdx < zhuadaode.selected.length-1; sIdx++)   //减一的目的是吧select的序列减去
            {
                // 对于每个 series：
                var dataIndices = zhuadaode.selected[sIdx].dataIndex;
                //
                for (var i = 0; i < dataIndices.length; i++) {
                    var dataIndex = dataIndices[i];
                    xuhao=fenzu[sIdx][dataIndex][2];
                    console.log(xuhao);
                    deepcopy.push(xuhao);
                }
            }


            // for (i = 0; i < zhuadaode.length; i++)
            //     console.log(zhuadaode[i]); // 显示抓到的数组下标//


            selectscattortopanel();





        });



        //--------------------------------------点击红色的函数-----------------------------------
        function setcolorscatter(obj)
        {

            var num=obj.id;

            console.log(num);


            //去跟新到每个点序列里面



          //  selectchange=0;   //!!!!!!!!


            //---------------------scatter的选择结果被染色-------------------


            for (var i=0;i<deepcopy.length;i++) {
                var a=deepcopy[i];
                data[a][2]=parseInt(num);
                console.log(deepcopy[i]);
                //cococo也染色
                cococo[parseInt(a / lie)+1][a % lie+1] = parseInt(num); //点击后 颜色直接过去
            }

            //---------------------------panel的选择结果也需要被染色------------------


            //
            // for (var j=0;j<selected.length;j++) {
            //     data[selected[j][2]][2]=parseInt(num);
            //
            //
            // }





            refreshscatter();

             refreshpanel();

        }


function colorscattortopanel() {

    cococo = [
        [9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9],
        [9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9],
        [9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9],
        [9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9],
        [9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9],
        [9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9],
        [9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9],
        [9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9],
        [9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9]

    ];//面板标记颜色清空


    for (var a = 0; a < data.length; a++) {
        {

            cococo[parseInt(a / lie) + 1][a % lie + 1] = data[a][2];

        }


    }

}

function selectscattortopanel() {

    // hahaha = [
    //     [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    //     [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    //     [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    //     [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    //     [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    //     [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    //     [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    //     [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    //     [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
    // ];  //panel先清空


    for (var i = 0; i < deepcopy.length; i++) {
        {
            var a = deepcopy[i];
            hahaha[parseInt(a / lie) + 1][a % lie + 1] = 1;

        }


    }


    refreshpanel();


}


var selected=[]; //这个全局数组标志


function selectpaneltoscatter() {


//先要清空sctter选区 ！！！！！

    selected=[];


    for (var i = 0; i < hang; i++)
    {
        for (var j = 0; j < lie; j++)
        {
            if(hahaha[i+1][j+1]==1)
            {


                selected.push([data[lie * i + j][0],data[lie * i + j][1],lie * i + j]);
                console.log(lie * i + j);

            }
        }

    }

    refreshscatter();

}


var panelsize=60; //panel棋盘边长可调节
var hang=8,lie=12;  //棋盘行列数 可调节
var hahaha=[
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0]


];//panel被选中数组
var nonono=[
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0]

];//鼠标移动时候被选中临时数组 加一个头标记整个行列选中
var cococo=[
    [9,9,9,9,9,9,9,9,9,9,9,9,9],
    [9,9,9,9,9,9,9,9,9,9,9,9,9],
    [9,9,9,9,9,9,9,9,9,9,9,9,9],
    [9,9,9,9,9,9,9,9,9,9,9,9,9],
    [9,9,9,9,9,9,9,9,9,9,9,9,9],
    [9,9,9,9,9,9,9,9,9,9,9,9,9],
    [9,9,9,9,9,9,9,9,9,9,9,9,9],
    [9,9,9,9,9,9,9,9,9,9,9,9,9],
    [9,9,9,9,9,9,9,9,9,9,9,9,9]

];//面板标记颜色







        function refreshpanel()   //obj是文档元素canvas传递过来 增加效率
        {  //画圈圈和框框

            var oncanvas = document.getElementById('bbb');
            var ctx = oncanvas.getContext('2d');


            ctx.clearRect(0,0,1000,1000);

        //----------------------------画边框

            for (var i = 0; i < hang; i++)
            {
                ctx.beginPath();
                ctx.lineWidth=2;
                ctx.strokeRect(0, i * panelsize+0.4*panelsize, 0.4*panelsize, panelsize);


                if (hahaha[i][0]>0)  //如果整个行被选中
                {
                    ctx.fillStyle =ctx.strokeStyle = 'rgba(55,55,55,0.5)';

                    ctx.fillRect(0, i * panelsize+0.4*panelsize, 0.4*panelsize, panelsize);

                }

                ctx.closePath();

            }


            for (var j = 0; j < lie; j++)
            {


                ctx.beginPath();
                ctx.lineWidth=2;
                ctx.strokeRect(j * panelsize+0.4*panelsize, 0, panelsize, 0.4*panelsize);
                ctx.closePath();


            }








            //---------------------------画面板
            ctx.save();
            ctx.translate(panelsize*0.4,panelsize*0.4);
            for (var i = 0; i < hang; i++)
            {
                for (var j = 0; j < lie; j++)
                {
                    //ctx.fillStyle =ctx.strokeStyle = 'rgb(0,' + Math.floor(255 - 255/lie * j) + ',' + Math.floor(255 - 255/hang * i) + ')';
                    ctx.fillStyle =ctx.strokeStyle ="black";

                    ctx.beginPath();
                    ctx.lineWidth=2;
                    ctx.strokeRect(j * panelsize, i * panelsize, panelsize, panelsize);  //画框框
                    //出点点
                    ctx.font ='1px 微软雅黑 bold';
                    ctx.fillStyle = '#000000';
                    var Ax=String.fromCharCode(64+i+1)+(j+1).toString();

                    ctx.textAlign="end";

                    ctx.fillText(Ax ,j * panelsize+panelsize-1, i * panelsize+panelsize-2);



                    // ctx.arc(panelsize / 2 + j * panelsize  , panelsize / 2 + i * panelsize , panelsize * 0.4, 0, Math.PI * 2,true); //画圈圈
                    // ctx.stroke();
                    ctx.closePath();

                    // if (hahaha[i][j] != 0)
                    //     //ctx.fillRect(i * panelsize, j * panelsize, panelsize, panelsize);
                    //     ctx.fill();
                    // else


                    ctx.beginPath();
                    ctx.fillStyle =ctx.strokeStyle = 'rgba(0,' + Math.floor(255 - 255/lie * j) + ',' +
                        Math.floor(255 - 255/hang * i) + ',0.5)';
                    if(nonono[i+1][j+1]>0)  //选择过程中的标识
                        ctx.fillRect(j * panelsize, i * panelsize, panelsize, panelsize);
                    if(hahaha[i+1][j+1]>0)  //被选中
                        ctx.fillRect(j * panelsize, i * panelsize, panelsize, panelsize);
                    if(cococo[i+1][j+1]==0) {

                        ctx.fillStyle = "#000000";
                        ctx.arc(panelsize / 2 + j * panelsize, panelsize / 2 + i * panelsize, panelsize * 0.38, 0, Math.PI * 2, true); //画圈圈
                        ctx.fill();
                    }
                    if(cococo[i+1][j+1]==1) {

                        ctx.fillStyle = "#4caf50";
                        ctx.arc(panelsize / 2 + j * panelsize, panelsize / 2 + i * panelsize, panelsize * 0.38, 0, Math.PI * 2, true); //画圈圈
                        ctx.fill();
                    }
                    if(cococo[i+1][j+1]==2) {

                        ctx.fillStyle = "#008cba";
                        ctx.arc(panelsize / 2 + j * panelsize, panelsize / 2 + i * panelsize, panelsize * 0.38, 0, Math.PI * 2, true); //画圈圈
                        ctx.fill();
                    }
                    if(cococo[i+1][j+1]==3) {

                        ctx.fillStyle = "#b80af4";
                        ctx.arc(panelsize / 2 + j * panelsize, panelsize / 2 + i * panelsize, panelsize * 0.38, 0, Math.PI * 2, true); //画圈圈
                        ctx.fill();
                    }
                    ctx.closePath();


                }


                ctx.closePath();

            }

            ctx.restore();







        }




        //--------------------这个函数在于不去绘制任何图形只是操作数据结构而已
        function initcanvaspanel()
        {  //画圈圈和框框

            var oncanvas = document.getElementById('bbb');
            var ctx = oncanvas.getContext('2d');

            ctx.clearRect(0,0,800,600);

            oncanvas.onmouseover = function (ev)
            {  //鼠标进入区域
                console.log("onmouseoverbbb");
            };

            oncanvas.onmouseout =function ()
            {//鼠标移动出区域
                console.log("onmouseoutbbb");
                oncanvas.onmousemove=null;
                // document.onmouseup =null;
            };







            oncanvas.onmousedown=function (ev)  //鼠标按下去
            {
                console.log("onmousedown");
                //鼠标点下去
                //鼠标所在的位置
                //ev.offsetX
                //ev.offsetY
                var oldX = ev.offsetX-0.4*panelsize;
                var oldY = ev.offsetY-0.4*panelsize;
                var balldownX1 = Math.floor(oldX / panelsize);
                var balldownY1 = Math.floor(oldY / panelsize);

                console.log(balldownX1);
                console.log(balldownY1);


                nonono[balldownY1+1][balldownX1+1]=1;





                oncanvas.onmousemove=function (ev)   //鼠标按下去后框选
                {
                    console.log("onmousemove");
                    var oldX = ev.offsetX-0.4*panelsize;
                    var oldY = ev.offsetY-0.4*panelsize;


                    //----------------------------------------------矩形框选 任意方向矩形
                    var ballmoveX2 = Math.floor(oldX / panelsize);
                    var ballmoveY2 = Math.floor(oldY / panelsize);



                    nonono[ballmoveY2+1][ballmoveX2+1]=1;
                    console.log(ballmoveY2);
                    console.log(ballmoveX2);



                    var x1=Math.min(balldownX1,ballmoveX2);
                    var x2=Math.max(balldownX1,ballmoveX2);
                    var y1=Math.min(balldownY1,ballmoveY2);
                    var y2=Math.max(balldownY1,ballmoveY2);


                    //-------------------标记数组清空-----------------
                    nonono=[
                        [0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0]
                    ];

                    //把选中的格子标记在nonono里面

                    for (i = x1; i <= x2; i++)
                        for (j = y1; j <= y2; j++)
                            nonono[j+1][i+1] = 1;

                    refreshpanel();


                }



                oncanvas.onmouseup=function (ev) //松开 有点好玩
                {
                    console.log("onmouseup");
                    oncanvas.onmousemove=null;
                    oncanvas.onmouseup =null;



                    var oldX = ev.offsetX;
                    var oldY = ev.offsetY;


                    //----------------------------------------------矩形框选 任意方向矩形

                    var ballupX2 = Math.floor(oldX / panelsize);
                    var ballupY2 = Math.floor(oldY / panelsize);


                    //如果点击同一个格子，则取消选择


                    // ----判断 如果点击和松开在同一个格子，则取消

                    // if (balldownX1==ballupX2 && balldownY1==ballupY2)
                    //
                    //     if(hahaha[balldownX1][balldownY1]==1)
                    //
                    //         nonono[balldownX1][balldownY1]=hahaha[balldownX1][balldownY1]=0;

                    //放开把nonono放入到hahaha中，并清空nonono
                    //如果按了control就添加 否则就以选中为准
                    if(ev.ctrlKey)
                    {
                        for (var i = 0; i < hang; i++) {
                            for (var j = 0; j < lie; j++) {
                                if(hahaha[i+1][j+1]+nonono[i+1][j+1]>=1)
                                    hahaha[i+1][j+1] = 1;
                                else
                                    hahaha[i+1][j+1]=0;
                                nonono[i+1][j+1] = 0;
                            }
                        }
                    }
                    else
                    {
                        for (var i = 0; i < hang; i++) {
                            for (var j = 0; j < lie; j++) {
                                //if(hahaha[i][j]+nonono[i][j]>=1)
                                hahaha[i+1][j+1] = nonono[i+1][j+1];
                                // else
                                //     hahaha[i][j]=0;
                                nonono[i+1][j+1] = 0;
                            }
                        }
                    }


                   // paneltoscatter();
                    selectpaneltoscatter();

                 //   refreshscatter();
                    refreshpanel();//改变hahaha[]后 重绘


                };


                refreshpanel();  //down函数按下去后重绘

            };


            refreshpanel();


        }








</script>














</body>
</html>