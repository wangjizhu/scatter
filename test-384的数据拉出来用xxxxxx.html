<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ECharts</title>

    <script src="./echarts.js"></script>
    <script src='./ecStataaa.js'></script>


    <style>
        canvas { border: 1px solid black; }



        .button_color {
        //background-color: #4CAF50; /* Green */
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            /*display: inline-block;*/
            font-size: 16px;
            cursor: pointer;
            /*float: left;*/
        }
        .button0 {
            background-color: #000000;
        }
        .button1 {
            background-color: #4CAF50;
        }
        .button2 {
            background-color: #008CBA;
        }
        .button3 {
            background-color: #b80af4;
        }
        .button4 {
            background-color: #ffffff;
        }
        .button0:hover {
            background-color: #808080;
        }
        .button1:hover {
            background-color: #808080;
        }
        .button2:hover {
            background-color: #808080;
        }
        .button3:hover {
            background-color: #808080;
        }


        .button4{color: black;}
        .button4:hover {
            background-color: #808080;
        }


    </style>



</head>
<body onload="initscatter()">
<!-- 为ECharts准备一个具备大小（宽高）的Dom -->
<div>
    <!--//id=1 2 3 直接用户数组小标 不用判断-->
    <button id="0" class="button_color button0" onclick="setcolorscatter(this)">Black</button>
    <button id="1" class="button_color button1" onclick="setcolorscatter(this)">Green</button>
    <button id="2" class="button_color button2" onclick="setcolorscatter(this)">Blue</button>
    <button id="3" class="button_color button3" onclick="setcolorscatter(this)">red</button>
    <button id="4" class="button_color button4" onclick="setcolorscatter(this)">打叉叉</button>

    <button id="5" onclick="clustering()">聚类</button>
    <button id="6" onclick="yiwanci()">一万次</button>
    <button id="8" onclick="dikaer()">笛卡尔</button>
    <button id="7" onclick="jizuobiao()">极坐标</button>
    <button id="7" onclick="daochu()">导出</button>


    <!--<button class="button">Button</button>-->
</div>

<div style="float:left">
    <div id="main" style="width: 600px;height:600px;"></div>
    <div style="float:left">
        <input type="range" id="myRange" value ="90" min="50" max="100" step="0.01" oninput="flitter()"/>
    </div>
    <div style="float:left">
        <p id="flitter">90.0%</p>
    </div>

<!--<button oninput="flitter()">flitter</button>-->

    <div style="clear:both">

            Xstart: <input type="text" id="x1" value="700"/>
            Xend: <input type="text" id="x2" value="800"/>
            <button id="7" class="change" onclick="changX()">改变X轴</button>
    </div>

    <div style="clear:both">

    Ystart: <input type="text" id="y1" value="700"/>
    Yend: <input type="text" id="y2" value="800"/>
    <button id="8" class="change" onclick="changY()">改变Y轴</button>
    </div>
</div>


<div style="float:left">
    <canvas id="bbb" width="800" height="600"></canvas>
</div>

<script type="text/javascript">


//------------------------------------------------------------



function changX()
{
    var x1=parseInt(document.getElementById("x1").value);
    var x2=parseInt(document.getElementById("x2").value);



    myChart.setOption({
        dataZoom: [{
           // type: 'value',
            xAxisIndex: 0,
            startValue: x1,
            endValue: x2
            //name:'FAM'

             },

            {
            // type: 'value',
            //yAxisIndex: 0,

            //name:'FAM'

        }


        ]
        })

}

function changY() {
    var y1 = parseInt(document.getElementById("y1").value);
    var y2 = parseInt(document.getElementById("y2").value);


    myChart.setOption({
        dataZoom: [
            {
                // type: 'value',
                //xAxisIndex: 0,

                //name:'FAM'

            },

            {
            // type: 'value',
            yAxisIndex: 0,
            startValue: y1,
            endValue: y2
            //name:'FAM'
            }


        ]
    })

}





function flitter() {
        var x = document.getElementById("myRange").value;

        document.getElementById("flitter").innerHTML = x+'%';

        quanlity=x;

        for(var n=0;n<96;n++){

            if (data[n][2]>0&&data[n][2]<5) {

                if (data[n][7] < quanlity / 100)     //判定阈值判断
                {
                    data[n][2] = 4;
                }
                else
                {
                    var maxnum = maxof3(data[n][4], data[n][5], data[n][6]);
                    data[n][2] = maxnum[0]+1;
                }

            }

        }

        refreshscatter();


    }




    var cishu=500;
    var quanlity=0.80;

    var zuobiaoxi=0; //目前选择的状态标记0表示笛卡尔 1表示极坐标


//------------------------一下是两个数组初始化datadikaer指向dikaer数组空间，datajizuobiao指向dikaer数组空间
//-------------------------坐标在初始化时候算死确定不用来回算，后面分组信息在单机按钮后相互转移


        var data=[];
        var datajizuobiao=[];
            var random = function (max){
                return ((Math.random()*max));
            };

       // 将数据装载到数组中
       //  for (var i = 0; i < 5; i++) {
       //      data.push([random(20)+10, random(20)+10,0,0,0,0,0,1]);
       //  };
       //  for (var i = 0; i < 24; i++) {
       //      data.push([random(50)+100, random(20)+10,5,0,0,0,0,1]);
       //  };
       //  for (var i = 0; i < 40; i++) {
       //      var a=random(100)
       //      data.push([random(20)+100, random(20)+100,5,0,0,0,0,1]);
       //  };
       //  for (var i = 0; i < 24; i++) {
       //      data.push([random(20)+10, random(100)+100,5,0,0,0,0,1]);
       //  };
       //  for (var i = 0; i < 3; i++) {
       //      data.push([random(100)+10, random(100)+10,5,0,0,0,0,1]);
       //  };


        var dataraw=[
            [0, 0.313159, 0.351204],
            [1, 0.321897, 0.343736],
            [2, 0.252508, 0.602671],
            [3, 0.234022, 0.560721],
            [4, 0.227738, 0.617326],
            [5, 0.230921, 0.56874],
            [6, 0.321957, 0.3889],
            [7, 0.31985, 0.354088],
            [8, 0.225925, 0.625766],
            [9, 0.241078, 0.575612],
            [10, 0.218328, 0.638897],
            [11, 0.22657, 0.576771],
            [12, 0.390158, 0.164686],
            [13, 0.382801, 0.152261],
            [14, 0.306808, 0.389341],
            [15, 0.308305, 0.352314],
            [16, 0.209846, 0.623909],
            [17, 0.24013, 0.561188],
            [18, 0.412121, 0.162864],
            [19, 0.410368, 0.158967],
            [20, 0.350613, 0.385094],
            [21, 0.352728, 0.342995],
            [22, 0.368538, 0.375365],
            [23, 0.443459, 0.333088],
            [24, 0.408587, 0.462235],
            [25, 0.404252, 0.463954],
            [26, 0.505847, 0.199239],
            [27, 0.504545, 0.190151],
            [28, 0.511451, 0.188752],
            [29, 0.481735, 0.186605],
            [30, 0.398649, 0.487492],
            [31, 0.375074, 0.492839],
            [32, 0.493444, 0.206435],
            [33, 0.523969, 0.199074],
            [34, 0.536339, 0.201309],
            [35, 0.518676, 0.192989],
            [36, 0.294976, 0.783518],
            [37, 0.288596, 0.789959],
            [38, 0.388913, 0.513747],
            [39, 0.401674, 0.510498],
            [40, 0.515324, 0.20124],
            [41, 0.506804, 0.204863],
            [42, 0.301149, 0.786043],
            [43, 0.314298, 0.803487],
            [44, 0.454593, 0.539672],
            [45, 0.430322, 0.531529],
            [46, 0.488134, 0.526377],
            [47, 0.522346, 0.539001],
            [48, 0.352906, 0.378058],
            [49, 0.353271, 0.34763],
            [50, 0.275059, 0.58869],
            [51, 0.29827, 0.549673],
            [52, 0.276091, 0.597719],
            [53, 0.28528, 0.547176],
            [54, 0.366616, 0.388707],
            [55, 0.360723, 0.354453],
            [56, 0.38066, 0.400215],
            [57, 0.388498, 0.354637],
            [58, 0.359049, 0.249607],
            [59, 0.353542, 0.208326],
            [60, 0.34655, 0.403486],
            [61, 0.337554, 0.368357],
            [62, 0.329271, 0.386349],
            [63, 0.345251, 0.346273],
            [64, 0.339237, 0.377731],
            [65, 0.34589, 0.323428],
            [66, 0.378747, 0.401766],
            [67, 0.377913, 0.360999],
            [68, 0.268064, 0.611692],
            [69, 0.284737, 0.562108],
            [70, 0.377443, 0.391725],
            [71, 0.413599, 0.341736],
            [72, 0.379822, 0.457522],
            [73, 0.39887, 0.473478],
            [74, 0.493895, 0.19665],
            [75, 0.498778, 0.195738],
            [76, 0.49337, 0.189136],
            [77, 0.51737, 0.200729],
            [78, 0.428796, 0.493836],
            [79, 0.437255, 0.511987],
            [80, 0.438762, 0.507648],
            [81, 0.43104, 0.507722],
            [82, 0.374411, 0.6151],
            [83, 0.295551, 0.738835],
            [84, 0.422853, 0.509449],
            [85, 0.393192, 0.513566],
            [86, 0.420748, 0.490118],
            [87, 0.412131, 0.501719],
            [88, 0.407124, 0.492405],
            [89, 0.396173, 0.502639],
            [90, 0.436773, 0.5102],
            [91, 0.430359, 0.508905],
            [92, 0.532344, 0.19874],
            [93, 0.531589, 0.195283],
            [94, 0.450526, 0.524273],
            [95, 0.500911, 0.54323],
            [96, 0.423054, 0.157322],
            [97, 0.421519, 0.158544],
            [98, 0.361493, 0.378094],
            [99, 0.367468, 0.345764],
            [100, 0.358854, 0.366016],
            [101, 0.366729, 0.318481],
            [102, 0.364896, 0.379624],
            [103, 0.37793, 0.352056],
            [104, 0.278107, 0.612861],
            [105, 0.286854, 0.556529],
            [106, 0.418914, 0.17915],
            [107, 0.417983, 0.172695],
            [108, 0.349753, 0.402322],
            [109, 0.34817, 0.35079],
            [110, 0.36407, 0.379595],
            [111, 0.357764, 0.322382],
            [112, 0.43403, 0.173865],
            [113, 0.415988, 0.167439],
            [114, 0.453952, 0.183569],
            [115, 0.445264, 0.181857],
            [116, 0.354911, 0.376307],
            [117, 0.367742, 0.328688],
            [118, 0.374941, 0.381939],
            [119, 0.429379, 0.348662],
            [120, 0.330222, 0.715704],
            [121, 0.309692, 0.720371],
            [122, 0.40846, 0.477551],
            [123, 0.412738, 0.497109],
            [124, 0.421223, 0.484468],
            [125, 0.418827, 0.485401],
            [126, 0.424706, 0.480113],
            [127, 0.435611, 0.493913],
            [128, 0.515752, 0.210007],
            [129, 0.512071, 0.209687],
            [130, 0.355248, 0.742068],
            [131, 0.313565, 0.78155],
            [132, 0.406455, 0.523568],
            [133, 0.417836, 0.522605],
            [134, 0.435932, 0.530234],
            [135, 0.424849, 0.537021],
            [136, 0.337676, 0.78998],
            [137, 0.342688, 0.772764],
            [138, 0.395655, 0.82631],
            [139, 0.353219, 0.814039],
            [140, 0.440253, 0.541935],
            [141, 0.425327, 0.540011],
            [142, 0.443565, 0.542349],
            [143, 0.509328, 0.542711],
            [144, 0.362443, 0.381251],
            [145, 0.378141, 0.347897],
            [146, 0.27166, 0.605987],
            [147, 0.295136, 0.56203],
            [148, 0.361871, 0.388932],
            [149, 0.368203, 0.339609],
            [150, 0.41988, 0.169258],
            [151, 0.39663, 0.166598],
            [152, 0.438437, 0.171996],
            [153, 0.419642, 0.163474],
            [154, 0.255757, 0.628294],
            [155, 0.26994, 0.578797],
            [156, 0.248932, 0.626761],
            [157, 0.274247, 0.584341],
            [158, 0.258247, 0.627587],
            [159, 0.25687, 0.57783],
            [160, 0.215442, 0.347938],
            [161, 0.251624, 0.169145],
            [162, 0.273759, 0.643287],
            [163, 0.294626, 0.571802],
            [164, 0.249245, 0.614571],
            [165, 0.285009, 0.565738],
            [166, 0.383468, 0.397448],
            [167, 0.385308, 0.35993],
            [168, 0.446618, 0.498214],
            [169, 0.413046, 0.472135],
            [170, 0.514627, 0.216826],
            [171, 0.493327, 0.204625],
            [172, 0.438986, 0.497567],
            [173, 0.426375, 0.503371],
            [174, 0.327984, 0.716148],
            [175, 0.323886, 0.74076],
            [176, 0.349763, 0.735479],
            [177, 0.314491, 0.760652],
            [178, 0.50741, 0.216895],
            [179, 0.521318, 0.212931],
            [180, 0.528047, 0.212992],
            [181, 0.502282, 0.208001],
            [182, 0.514828, 0.206636],
            [183, 0.489329, 0.19281],
            [184, 0.286024, 0.250014],
            [185, 0.285942, 0.154601],
            [186, 0.512835, 0.227761],
            [187, 0.523736, 0.22584],
            [188, 0.502666, 0.207198],
            [189, 0.544473, 0.228272],
            [190, 0.427289, 0.516687],
            [191, 0.455605, 0.552699],
            [192, 0.447363, 0.182236],
            [193, 0.416328, 0.16681],
            [194, 0.282061, 0.600126],
            [195, 0.294961, 0.563533],
            [196, 0.356049, 0.390406],
            [197, 0.34873, 0.3557],
            [198, 0.255573, 0.602926],
            [199, 0.288621, 0.553502],
            [200, 0.417375, 0.183066],
            [201, 0.410859, 0.172022],
            [202, 0.355939, 0.394666],
            [203, 0.367706, 0.360278],
            [204, 0.253986, 0.614687],
            [205, 0.278699, 0.550149],
            [206, 0.418311, 0.168007],
            [207, 0.409534, 0.166954],
            [208, 0.256246, 0.608158],
            [209, 0.280664, 0.539328],
            [210, 0.257329, 0.61439],
            [211, 0.297561, 0.544878],
            [212, 0.36748, 0.371628],
            [213, 0.374199, 0.315501],
            [214, 0.344542, 0.346475],
            [215, 0.382725, 0.335006],
            [216, 0.343942, 0.746682],
            [217, 0.320376, 0.730143],
            [218, 0.487275, 0.223532],
            [219, 0.480795, 0.208173],
            [220, 0.38742, 0.49395],
            [221, 0.409981, 0.511244],
            [222, 0.493681, 0.227342],
            [223, 0.506102, 0.219839],
            [224, 0.330209, 0.73434],
            [225, 0.323108, 0.758317],
            [226, 0.405758, 0.518442],
            [227, 0.40755, 0.514468],
            [228, 0.480983, 0.216395],
            [229, 0.472665, 0.204767],
            [230, 0.323161, 0.758376],
            [231, 0.303959, 0.781762],
            [232, 0.471602, 0.226904],
            [233, 0.498709, 0.222896],
            [234, 0.468481, 0.21313],
            [235, 0.491439, 0.210914],
            [236, 0.423568, 0.508743],
            [237, 0.465473, 0.511429],
            [238, 0.439773, 0.539079],
            [239, 0.460429, 0.54987],
            [240, 0.376232, 0.388971],
            [241, 0.367177, 0.360526],
            [242, 0.353286, 0.385265],
            [243, 0.34123, 0.350556],
            [244, 0.230571, 0.610792],
            [245, 0.251462, 0.569262],
            [246, 0.351148, 0.395303],
            [247, 0.360933, 0.366007],
            [248, 0.427267, 0.179209],
            [249, 0.415563, 0.178945],
            [250, 0.234927, 0.625967],
            [251, 0.249116, 0.572367],
            [252, 0.329158, 0.385237],
            [253, 0.326177, 0.354315],
            [254, 0.324819, 0.383407],
            [255, 0.333019, 0.362535],
            [256, 0.239756, 0.620398],
            [257, 0.255588, 0.566764],
            [258, 0.344951, 0.389105],
            [259, 0.354701, 0.345626],
            [260, 0.43081, 0.163229],
            [261, 0.413728, 0.162569],
            [262, 0.368656, 0.354117],
            [263, 0.374854, 0.317526],
            [264, 0.44045, 0.48922],
            [265, 0.4101, 0.49765],
            [266, 0.402435, 0.481515],
            [267, 0.395011, 0.493208],
            [268, 0.456968, 0.193286],
            [269, 0.481856, 0.201128],
            [270, 0.400697, 0.491911],
            [271, 0.411193, 0.500127],
            [272, 0.302164, 0.781186],
            [273, 0.281449, 0.771971],
            [274, 0.498171, 0.203494],
            [275, 0.495077, 0.186964],
            [276, 0.396027, 0.511168],
            [277, 0.39956, 0.51309],
            [278, 0.396214, 0.493135],
            [279, 0.396038, 0.496398],
            [280, 0.480667, 0.218263],
            [281, 0.488813, 0.203892],
            [282, 0.379019, 0.487685],
            [283, 0.391103, 0.501718],
            [284, 0.291032, 0.789798],
            [285, 0.305357, 0.757176],
            [286, 0.411112, 0.493489],
            [287, 0.440216, 0.506308],
            [288, 0.372626, 0.389299],
            [289, 0.33856, 0.334277],
            [290, 0.359405, 0.391773],
            [291, 0.341504, 0.361033],
            [292, 0.237255, 0.622038],
            [293, 0.268072, 0.561354],
            [294, 0.352713, 0.389824],
            [295, 0.356054, 0.37775],
            [296, 0.35972, 0.417969],
            [297, 0.349722, 0.380781],
            [298, 0.430056, 0.17333],
            [299, 0.424559, 0.165096],
            [300, 0.428603, 0.171628],
            [301, 0.408704, 0.168376],
            [302, 0.242385, 0.629565],
            [303, 0.244704, 0.565439],
            [304, 0.266997, 0.606593],
            [305, 0.267136, 0.517242],
            [306, 0.324439, 0.371105],
            [307, 0.32499, 0.311507],
            [308, 0.341229, 0.379148],
            [309, 0.339945, 0.317187],
            [310, 0.410246, 0.176505],
            [311, 0.442231, 0.151825],
            [312, 0.412404, 0.479656],
            [313, 0.392401, 0.480031],
            [314, 0.399869, 0.479929],
            [315, 0.385603, 0.487335],
            [316, 0.498595, 0.212081],
            [317, 0.490686, 0.209787],
            [318, 0.412399, 0.499645],
            [319, 0.41636, 0.504264],
            [320, 0.4202, 0.51393],
            [321, 0.411197, 0.521748],
            [322, 0.279537, 0.780176],
            [323, 0.281845, 0.79586],
            [324, 0.282772, 0.80838],
            [325, 0.322049, 0.790629],
            [326, 0.488564, 0.212449],
            [327, 0.498714, 0.209583],
            [328, 0.484549, 0.21977],
            [329, 0.48909, 0.214911],
            [330, 0.366633, 0.513646],
            [331, 0.374821, 0.525718],
            [332, 0.379232, 0.510046],
            [333, 0.405151, 0.53119],
            [334, 0.323199, 0.760543],
            [335, 0.329535, 0.782805],
            [336, 0.35135, 0.37007],
            [337, 0.338461, 0.327986],
            [338, 0.41221, 0.168926],
            [339, 0.403233, 0.163442],
            [340, 0.241635, 0.614163],
            [341, 0.256264, 0.551044],
            [342, 0.365739, 0.410476],
            [343, 0.3561, 0.378079],
            [344, 0.359399, 0.404257],
            [345, 0.344818, 0.374398],
            [346, 0.244488, 0.640333],
            [347, 0.264321, 0.596158],
            [348, 0.246889, 0.653207],
            [349, 0.249548, 0.599333],
            [350, 0.421012, 0.174645],
            [351, 0.409149, 0.164691],
            [352, 0.242188, 0.619988],
            [353, 0.243, 0.562912],
            [354, 0.402197, 0.169466],
            [355, 0.397688, 0.160753],
            [356, 0.421876, 0.165247],
            [357, 0.405563, 0.155789],
            [358, 0.274587, 0.612476],
            [359, 0.279608, 0.552612],
            [360, 0.41459, 0.475369],
            [361, 0.384472, 0.477657],
            [362, 0.318334, 0.720873],
            [363, 0.332492, 0.731692],
            [364, 0.46767, 0.199403],
            [365, 0.49107, 0.194361],
            [366, 0.396236, 0.490962],
            [367, 0.399675, 0.505647],
            [368, 0.410054, 0.497157],
            [369, 0.407506, 0.502022],
            [370, 0.495195, 0.184221],
            [371, 0.486683, 0.180916],
            [372, 0.471751, 0.174793],
            [373, 0.503293, 0.186509],
            [374, 0.261183, 0.767431],
            [375, 0.267778, 0.782398],
            [376, 0.491249, 0.194593],
            [377, 0.480138, 0.180045],
            [378, 0.267841, 0.789053],
            [379, 0.27025, 0.791515],
            [380, 0.269267, 0.809467],
            [381, 0.268287, 0.796367],
            [382, 0.515285, 0.203729],
            [383, 0.531597, 0.182078]
        ];



        for (var a=0;a<dataraw.length;a++)
        {
            if((Math.floor(a/24))%2==1&&(a%24)%2==0)
                data.push([dataraw[a][1],dataraw[a][2],5,0,0,0,0,1]);


        }








        // for ( i = 0; i < 4; i++) {
        //     data.push([random(990), random(990),5,0,0,0,0,1,0]);
        // };

        var datadikaer =data;       //datadikaer初始化

        for (var i=0;i<datadikaer.length;i++)    //datajizuobiao初始化
        {
            r=Math.log10((Math.sqrt(datadikaer[i][0]*datadikaer[i][0]+datadikaer[i][1]*datadikaer[i][1])));
            therta=Math.atan(datadikaer[i][1]/datadikaer[i][0]);

            datajizuobiao.push([r,therta,datadikaer[i][2],datadikaer[i][3],datadikaer[i][4],datadikaer[i][5],datadikaer[i][6],datadikaer[i][7]]);

        }


        function daochu() {






        }

        function jizuobiao()
        {
            if (zuobiaoxi==0)
            {
                zuobiaoxi=1;

                selected=[];  //选择清空

                for (var i = 0; i < datadikaer.length; i++) {
                    for (var j = 2; j < 9; j++)

                        datajizuobiao[i][j] = datadikaer[i][j];

                }

                data = datajizuobiao;      //data指向极坐标

                refreshscatter();
            }


        }

        function dikaer()
        {
            if(zuobiaoxi==1) {

        zuobiaoxi=0;
                selected=[];  //选择清空
                for (var i = 0; i < datadikaer.length; i++) {
                    for (var j = 2; j < 9; j++)

                        datadikaer[i][j] = datajizuobiao[i][j];

                }

                data = datadikaer;   //data指向笛卡尔

                refreshscatter();
            }
        }











        // 基于准备好的dom，初始化echarts实例

        // var data = [];//数据区域缩放组件
        var fenzu=[[],[],[],[]];
        var zhuadaode=[[],[],[],[]];

        var myChart = echarts.init(document.getElementById('main'));

        // function savepic()
        // {
        //     //  var img = new Image();
        //     varaaa = myChart.getDataURL({
        //         type:'jpeg',
        //         pixelRatio: 1,
        //         //backgroundColor: '#fff'
        //         excludeComponents: ['toolbox']
        //     });



         //   }






        var selectchange =1;
        var deepcopy=[];


        function maxof3 (a,b,c)
        {
            var max=a,num=0;
            if (max<b) {
                max = b;
                num=1;
            }
            if (max<c) {
                max = c;
                num=2;
            }


            return [num,max]


        }
    //------------------------聚类一万次---------------------------


        function yiwanci()
    {



//清空
        for(var n=0;n<96;n++){


            data[n][3]=data[n][4]=data[n][5]=data[n][6]=data[n][7]=0;
           //黑色

        }




        for(var i=0;i<cishu;i++)
        {



            clustering();

            for(var n=0;n<96;n++){

             //   if(data[n][2]>0&&data[n][2]<5)
                data[n][data[n][2]+3]++;

            }

        }


         for(var n=0;n<96;n++){
        //


             if(data[n][2]>0) {

                 var maxnum = maxof3(data[n][4], data[n][5], data[n][6]);
                 data[n][2] = maxnum[0] + 1;
                 data[n][7] = maxnum[1] / cishu;

                 if (data[n][7] < quanlity)     //判定阈值判断
                     data[n][2] = 4;
             }



        }





        flitter();

        //refreshscatter();


    }






        var result;
        var ordercentroids=[];
        var nnn=0;

//--------------------聚类!!!!!!!!!!!!!!!!!!!!!!!!!-3类----------------------------------------

        function clustering() {

            var count = 0;

            console.log('clustering');
            var clusterNumber = 3;
            var dataclustering=[];//清空


            //采集需要聚类的点放入dataclustering

            // if(zuobiaoxi==0)
            // {
            //     data=datadikaer;
            //
            // }
            // else
            //     if(zuobiaoxi==1)
            //     {
            //         data=datajizuobiao
            //
            //     }
            //


            for (var i=0;i<data.length;i++)
            {
                if(data[i][2]>0)
                    dataclustering.push([data[i][0]*1000,data[i][1]*1000,i]); //放大一千倍放进去聚类
            }



//console.log("stop");

            result = ecStat.clustering.hierarchicalKMeans(dataclustering, clusterNumber, false);

//有时候分出来不是四个组很奇怪。


            // for (var a = 0; a < result.centroids.length; a++) {
            //     if (result.centroids[a].length > 0)
            //         count++;
            //
            // }

            // if (count<4)
            //     n++;

            //console.log(count);

            // if (count<3)    //变态的是 测试了很久很久 这个kmean聚类返回的结果可能不是4类 我也是醉了 小于3重来
            // {
            //     clustering();
            //
            // }

            //----------------------------一下才是3组的处理内容
//             else
//             {
//
//
                ordercentroids = [
                    [result.centroids[0][1]/result.centroids[0][0],0],
                    [result.centroids[1][1]/result.centroids[1][0],1],
                    [result.centroids[2][1]/result.centroids[2][0],2]
                  //  [result.centroids[3][0], result.centroids[3][1]]

                ];  //复制出来加一位



                //
                //=---------------------排序

                ordercentroids.sort(function (a, b) {
                    return b[0]-a[0];
                });                            //按照x坐标排序 序号记录进入第四位


                for (var i = 0; i < ordercentroids.length; i++)  //加一位 插入原始序号

                {
                    ordercentroids[i].push(i);  //排序后序号

                }
//
//
                ordercentroids.sort(function (a, b) {
                    return a[1]-b[1];
                });                                              //在排回去





//                 if (ordercentroids[0][1] > ordercentroids[1][1]) {
//                     ordercentroids[0][3] = 1;
//                     ordercentroids[1][3] = 0;
//
//                 }
//
//
//                 if (ordercentroids[2][1] > ordercentroids[3][1]) {
//                     ordercentroids[2][3] = 3;
//                     ordercentroids[3][3] = 2;
//
//                 }
//
// //-----------------以下这个循环不是人类可以理解的 如果正确了 那么分组将按照顺序赋值给原始数据的分组项
//                 //-----------------如果错了 我也想不出来怎么调试了 但是不幸的是 他对了
//
//
//
//
//                 for (var i = 0; i < 96; i++) {
//
//                     //         console.log(result.clusterAssment[i][0]);
//
//                     //        data[i][2]=result.clusterAssment[i][0];
//
//
//                     for (var n = 0; n < ordercentroids.length; n++) {
//                         if (result.clusterAssment[i][0] === ordercentroids[n][2]) {
//                             data[i][2] = ordercentroids[n][3]
//                         }
//
//                     }
//
//                 }

//-----------------------------------------------------------------------------
//                else

            for (var n = 0; n < dataclustering.length; n++)                   //逆天的操作啊
            {
                data[dataclustering[n][2]][2]=ordercentroids[result.clusterAssment[n][0]][2]+1;   //分组的颜色直接染给对应的data

            }


                colorscattortopanel();


                refreshscatter();
                refreshpanel();
             //   console.log(nnn++);





        }

        function initscatter()
        {

            //构造随机数
            // var random = function (max){
            //     return ((Math.random()*max));
            // };

            //将数据装载到数组中
            // for (var i = 0; i < 25; i++) {
            //     data.push([random(99), random(99),0]);
            // };
            //
            // for ( i = 25; i < 50; i++) {
            //     data.push([random(99), random(99),1]);
            // };
            //
            // for ( i = 50; i < 75; i++) {
            //     data.push([random(99), random(99),2]);
            // };
            //
            // for ( i = 75; i < 100; i++) {
            //     data.push([random(99), random(99),3]);
            // };

            refreshscatter();


            initcanvaspanel();

        }

        function refreshscatter(){

//console.log('refresh');
            //myChart.clear();
                  //0  1  2  3  4   5   6
                  //b  g  b  r  x   n   s
            fenzu=[[],[],[], [],[],[], []];

           // var select=[];

            for (var i = 0; i < 96; i++){
                fenzu[data[i][2]].push([data[i][0],data[i][1],i]);  //i表示在原数组中的位置
            }




            option = {

                tooltip : {
                    // padding: 10,
                    trigger: 'item',
                    //trigger: 'axis',
                    axisPointer: {
                        type: 'cross'

                    },
                    formatter: '{b}',
                },

                toolbox: {
                    left: 'right',
                    itemSize: 25,
                    top: 5,
                    feature: {
                        myTool1: {
                            show: true,
                            title: '保存图片',
                            icon: 'image://http://echarts.baidu.com/images/favicon.png',
                            //onclick: savepic()


                        },

                        // brush:{
                        //     type: 'rect',
                        //
                        // },
                        //
                        // brush:{
                        //     type: 'polygon',
                        //
                        // },

                        dataZoom: {

                        },



                        //
                        //
                        // myTool2: {
                        //     show: true,
                        //     title: '设置Y轴',
                        //     icon: 'image://http://echarts.baidu.com/images/favicon.png',
                        //     onclick: function () {
                        //         alert('myToolHandler2')
                        //     }
                        //
                        // },


                        restore: {},




                    },

                },



                brush:
                    {
                        toolbox:['rect','polygon','clear'],

                        brushType: 'rect',


                        romoveOnClick:'signle'    //单击空白处清空选择
                    },


                xAxis: [{
                    type: 'value',
                    scale: true,
                    min: function(value) {
                        return value.min-(value.max-value.min)*0.1 ;
                    },
                   max: function(value) {
                       return value.max+(value.max-value.min)*0.1 ;
                   },
                    name:'FAM',
                    nameLocation: 'center',
                    nameGap: 20,
                    nameTextStyle: {



                        fontSize: 18,

                        // verticalAlign: ...,
                        // lineHeight: ...,

                    }
                }]
                ,


                yAxis:
                    {
                        type: 'value',
                        scale: true,
                        min: function(value) {
                            return value.min-(value.max-value.min)*0.1 ;
                        },
                        max: function(value) {
                            return value.max+(value.max-value.min)*0.1;
                        },
                        name:'HEX',
                        nameLocation: 'center',
                        nameGap: 20,
                        nameTextStyle: {


                            fontSize: 18,

                            // verticalAlign: ...,
                            // lineHeight: ...,

                        }
                    }
                ,


                dataZoom: [
                    // 这个dataZoom组件，也控制y轴。


                    {   // 这个dataZoom组件，也控制x轴。
                        type: 'inside', // 这个 dataZoom 组件是 inside 型 dataZoom 组件
                        xAxisIndex: 0,
                        filterMode: 'empty',
                         // start: 10,      // 左边在 10% 的位置。
                         // end: 110         // 右边在 60% 的位置。
                    },
                    {
                        type: 'inside',
                        yAxisIndex: 0,
                        filterMode: 'empty',
                         // start: 10,
                         // end: 110
                    }


                ],


                series: [

                    {
                        animation: false,
                        name: 'black',
                        type: 'scatter',
                        symbolSize: 10,
                        z:'0',

                        data: fenzu[0],
                        itemStyle: {
                            color: '#000000'
                        },
                        symbol:'rect',

                    },


                    {
                        animation: false,
                        name:'green',
                        type: 'scatter',
                        symbolSize: 10,
                        z:'0',

                        data: fenzu[1],


                        itemStyle: {
                            color: '#4caf50'
                        }


                    },

                    {
                        animation: false,
                        name: 'blue',
                        type: 'scatter',
                        symbolSize: 10,
                        z:'0',

                        data: fenzu[2],


                        itemStyle: {
                            color: '#008cba'
                        },

                     //   symbol:'rect',

                    },

                    {
                        animation: false,
                        name:'red',
                        type: 'scatter',
                        symbolSize: 10,
                        z:'0',

                        data: fenzu[3],


                        itemStyle: {
                            color: '#b80af4'
                        },
                    //    symbol: 'triangle'


                    },


                    {
                        animation: false,
                        name: 'chacha',
                        type: 'scatter',
                        symbolSize: 10,
                        z: '0',

                        data: fenzu[4],


                        itemStyle: {
                            color: '#ff1736'
                        },

                        symbol: 'triangle'


                    },

                    {
                        animation: false,
                        name: 'none',
                        type: 'scatter',
                        symbolSize: 10,
                        z: '0',

                        data: fenzu[5],


                        itemStyle: {
                            color: '#787878'
                        },

                   //     symbol: 'triangle'


                    },

                    {
                        animation: false,
                        name: 'select',
                        type: 'scatter',
                        symbolSize: 20,
                        z: '0',

                        data: selected,


                        itemStyle: {
                            color: '#19f8ff',

                            opacity: 0.6


                        },

                       //symbol: 'rect'



                    }


                ]
            };



            // 使用刚指定的配置项和数据显示图表。
            myChart.setOption(option);


        }



myChart.on('brush', function ()          //这个事件用来出发清除panel选框
{


    hahaha=[
        [0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0]


    ];







});




        myChart.on('brushSelected', function (params) {
            //var brushComponent = params.batch[0];

            //var sum = 0; // 统计选中项的数据值的和
           // var xuhao;


            selectchange=1;
            zhuadaode=params.batch[0];
            deepcopy=[];


          //  selected=[];
   //         refreshscatter();


            console.log('hahaha');
            for (var sIdx = 0; sIdx < zhuadaode.selected.length-1; sIdx++)   //减一的目的是吧select的序列减去
            {
                // 对于每个 series：
                var dataIndices = zhuadaode.selected[sIdx].dataIndex;
                //
                for (var i = 0; i < dataIndices.length; i++) {
                    var dataIndex = dataIndices[i];
                    xuhao=fenzu[sIdx][dataIndex][2];
                    console.log(xuhao);
                    deepcopy.push(xuhao);
                }
            }


            // for (i = 0; i < zhuadaode.length; i++)
            //     console.log(zhuadaode[i]); // 显示抓到的数组下标//


            selectscattortopanel();





        });



        //--------------------------------------点击红色的函数-----------------------------------
        function setcolorscatter(obj)
        {

            var num=obj.id;

            console.log(num);


            //去跟新到每个点序列里面



          //  selectchange=0;   //!!!!!!!!


            //---------------------scatter的选择结果被染色-------------------


            for (var i=0;i<deepcopy.length;i++) {
                var a=deepcopy[i];
                data[a][2]=parseInt(num);
                console.log(deepcopy[i]);
                //cococo也染色
                cococo[parseInt(a / lie)+1][a % lie+1] = parseInt(num); //点击后 颜色直接过去
            }

            //---------------------------panel的选择结果也需要被染色------------------


            //
            // for (var j=0;j<selected.length;j++) {
            //     data[selected[j][2]][2]=parseInt(num);
            //
            //
            // }





            refreshscatter();

             refreshpanel();

        }


function colorscattortopanel() {

    cococo = [
        [9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9],
        [9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9],
        [9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9],
        [9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9],
        [9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9],
        [9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9],
        [9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9],
        [9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9],
        [9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9]

    ];//面板标记颜色清空


    for (var a = 0; a < data.length; a++) {
        {

            cococo[parseInt(a / lie) + 1][a % lie + 1] = data[a][2];

        }


    }

}

function selectscattortopanel() {

    // hahaha = [
    //     [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    //     [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    //     [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    //     [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    //     [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    //     [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    //     [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    //     [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    //     [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
    // ];  //panel先清空


    for (var i = 0; i < deepcopy.length; i++) {
        {
            var a = deepcopy[i];
            hahaha[parseInt(a / lie) + 1][a % lie + 1] = 1;

        }


    }


    refreshpanel();


}


var selected=[]; //这个全局数组标志


function selectpaneltoscatter() {


//先要清空sctter选区 ！！！！！

    selected=[];


    for (var i = 0; i < hang; i++)
    {
        for (var j = 0; j < lie; j++)
        {
            if(hahaha[i+1][j+1]==1)
            {


                selected.push([data[lie * i + j][0],data[lie * i + j][1],lie * i + j]);
                console.log(lie * i + j);

            }
        }

    }

    refreshscatter();

}


var panelsize=60; //panel棋盘边长可调节
var hang=8,lie=12;  //棋盘行列数 可调节
var hahaha=[
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0]


];//panel被选中数组
var nonono=[
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0,0,0,0,0,0]

];//鼠标移动时候被选中临时数组 加一个头标记整个行列选中
var cococo=[
    [9,9,9,9,9,9,9,9,9,9,9,9,9],
    [9,9,9,9,9,9,9,9,9,9,9,9,9],
    [9,9,9,9,9,9,9,9,9,9,9,9,9],
    [9,9,9,9,9,9,9,9,9,9,9,9,9],
    [9,9,9,9,9,9,9,9,9,9,9,9,9],
    [9,9,9,9,9,9,9,9,9,9,9,9,9],
    [9,9,9,9,9,9,9,9,9,9,9,9,9],
    [9,9,9,9,9,9,9,9,9,9,9,9,9],
    [9,9,9,9,9,9,9,9,9,9,9,9,9]

];//面板标记颜色







        function refreshpanel()   //obj是文档元素canvas传递过来 增加效率
        {  //画圈圈和框框

            var oncanvas = document.getElementById('bbb');
            var ctx = oncanvas.getContext('2d');


            ctx.clearRect(0,0,1000,1000);

        //----------------------------画边框

            for (var i = 0; i < hang; i++)
            {
                ctx.beginPath();
                ctx.lineWidth=2;
                ctx.strokeRect(0, i * panelsize+0.4*panelsize, 0.4*panelsize, panelsize);


                if (hahaha[i][0]>0)  //如果整个行被选中
                {
                    ctx.fillStyle =ctx.strokeStyle = 'rgba(55,55,55,0.5)';

                    ctx.fillRect(0, i * panelsize+0.4*panelsize, 0.4*panelsize, panelsize);

                }

                ctx.closePath();

            }


            for (var j = 0; j < lie; j++)
            {


                ctx.beginPath();
                ctx.lineWidth=2;
                ctx.strokeRect(j * panelsize+0.4*panelsize, 0, panelsize, 0.4*panelsize);
                ctx.closePath();


            }








            //---------------------------画面板
            ctx.save();
            ctx.translate(panelsize*0.4,panelsize*0.4);
            for (var i = 0; i < hang; i++)
            {
                for (var j = 0; j < lie; j++)
                {
                    //ctx.fillStyle =ctx.strokeStyle = 'rgb(0,' + Math.floor(255 - 255/lie * j) + ',' + Math.floor(255 - 255/hang * i) + ')';
                    ctx.fillStyle =ctx.strokeStyle ="black";

                    ctx.beginPath();
                    ctx.lineWidth=2;
                    ctx.strokeRect(j * panelsize, i * panelsize, panelsize, panelsize);  //画框框
                    //出点点
                    ctx.font ='1px 微软雅黑 bold';
                    ctx.fillStyle = '#000000';
                    var Ax=String.fromCharCode(64+i+1)+(j+1).toString();

                    ctx.textAlign="end";

                    ctx.fillText(Ax ,j * panelsize+panelsize-1, i * panelsize+panelsize-2);



                    // ctx.arc(panelsize / 2 + j * panelsize  , panelsize / 2 + i * panelsize , panelsize * 0.4, 0, Math.PI * 2,true); //画圈圈
                    // ctx.stroke();
                    ctx.closePath();

                    // if (hahaha[i][j] != 0)
                    //     //ctx.fillRect(i * panelsize, j * panelsize, panelsize, panelsize);
                    //     ctx.fill();
                    // else


                    ctx.beginPath();
                    ctx.fillStyle =ctx.strokeStyle = 'rgba(0,' + Math.floor(255 - 255/lie * j) + ',' +
                        Math.floor(255 - 255/hang * i) + ',0.5)';
                    if(nonono[i+1][j+1]>0)  //选择过程中的标识
                        ctx.fillRect(j * panelsize, i * panelsize, panelsize, panelsize);
                    if(hahaha[i+1][j+1]>0)  //被选中
                        ctx.fillRect(j * panelsize, i * panelsize, panelsize, panelsize);
                    if(cococo[i+1][j+1]==0) {

                        ctx.fillStyle = "#000000";
                        ctx.arc(panelsize / 2 + j * panelsize, panelsize / 2 + i * panelsize, panelsize * 0.38, 0, Math.PI * 2, true); //画圈圈
                        ctx.fill();
                    }
                    if(cococo[i+1][j+1]==1) {

                        ctx.fillStyle = "#4caf50";
                        ctx.arc(panelsize / 2 + j * panelsize, panelsize / 2 + i * panelsize, panelsize * 0.38, 0, Math.PI * 2, true); //画圈圈
                        ctx.fill();
                    }
                    if(cococo[i+1][j+1]==2) {

                        ctx.fillStyle = "#008cba";
                        ctx.arc(panelsize / 2 + j * panelsize, panelsize / 2 + i * panelsize, panelsize * 0.38, 0, Math.PI * 2, true); //画圈圈
                        ctx.fill();
                    }
                    if(cococo[i+1][j+1]==3) {

                        ctx.fillStyle = "#b80af4";
                        ctx.arc(panelsize / 2 + j * panelsize, panelsize / 2 + i * panelsize, panelsize * 0.38, 0, Math.PI * 2, true); //画圈圈
                        ctx.fill();
                    }
                    ctx.closePath();


                }


                ctx.closePath();

            }

            ctx.restore();







        }




        //--------------------这个函数在于不去绘制任何图形只是操作数据结构而已
        function initcanvaspanel()
        {  //画圈圈和框框

            var oncanvas = document.getElementById('bbb');
            var ctx = oncanvas.getContext('2d');

            ctx.clearRect(0,0,800,600);

            oncanvas.onmouseover = function (ev)
            {  //鼠标进入区域
                console.log("onmouseoverbbb");
            };

            oncanvas.onmouseout =function ()
            {//鼠标移动出区域
                console.log("onmouseoutbbb");
                oncanvas.onmousemove=null;
                // document.onmouseup =null;
            };







            oncanvas.onmousedown=function (ev)  //鼠标按下去
            {
                console.log("onmousedown");
                //鼠标点下去
                //鼠标所在的位置
                //ev.offsetX
                //ev.offsetY
                var oldX = ev.offsetX-0.4*panelsize;
                var oldY = ev.offsetY-0.4*panelsize;
                var balldownX1 = Math.floor(oldX / panelsize);
                var balldownY1 = Math.floor(oldY / panelsize);

                console.log(balldownX1);
                console.log(balldownY1);


                nonono[balldownY1+1][balldownX1+1]=1;





                oncanvas.onmousemove=function (ev)   //鼠标按下去后框选
                {
                    console.log("onmousemove");
                    var oldX = ev.offsetX-0.4*panelsize;
                    var oldY = ev.offsetY-0.4*panelsize;


                    //----------------------------------------------矩形框选 任意方向矩形
                    var ballmoveX2 = Math.floor(oldX / panelsize);
                    var ballmoveY2 = Math.floor(oldY / panelsize);



                    nonono[ballmoveY2+1][ballmoveX2+1]=1;
                    console.log(ballmoveY2);
                    console.log(ballmoveX2);



                    var x1=Math.min(balldownX1,ballmoveX2);
                    var x2=Math.max(balldownX1,ballmoveX2);
                    var y1=Math.min(balldownY1,ballmoveY2);
                    var y2=Math.max(balldownY1,ballmoveY2);


                    //-------------------标记数组清空-----------------
                    nonono=[
                        [0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0,0,0,0,0,0]
                    ];

                    //把选中的格子标记在nonono里面

                    for (i = x1; i <= x2; i++)
                        for (j = y1; j <= y2; j++)
                            nonono[j+1][i+1] = 1;

                    refreshpanel();


                }



                oncanvas.onmouseup=function (ev) //松开 有点好玩
                {
                    console.log("onmouseup");
                    oncanvas.onmousemove=null;
                    oncanvas.onmouseup =null;



                    var oldX = ev.offsetX;
                    var oldY = ev.offsetY;


                    //----------------------------------------------矩形框选 任意方向矩形

                    var ballupX2 = Math.floor(oldX / panelsize);
                    var ballupY2 = Math.floor(oldY / panelsize);


                    //如果点击同一个格子，则取消选择


                    // ----判断 如果点击和松开在同一个格子，则取消

                    // if (balldownX1==ballupX2 && balldownY1==ballupY2)
                    //
                    //     if(hahaha[balldownX1][balldownY1]==1)
                    //
                    //         nonono[balldownX1][balldownY1]=hahaha[balldownX1][balldownY1]=0;

                    //放开把nonono放入到hahaha中，并清空nonono
                    //如果按了control就添加 否则就以选中为准
                    if(ev.ctrlKey)
                    {
                        for (var i = 0; i < hang; i++) {
                            for (var j = 0; j < lie; j++) {
                                if(hahaha[i+1][j+1]+nonono[i+1][j+1]>=1)
                                    hahaha[i+1][j+1] = 1;
                                else
                                    hahaha[i+1][j+1]=0;
                                nonono[i+1][j+1] = 0;
                            }
                        }
                    }
                    else
                    {
                        for (var i = 0; i < hang; i++) {
                            for (var j = 0; j < lie; j++) {
                                //if(hahaha[i][j]+nonono[i][j]>=1)
                                hahaha[i+1][j+1] = nonono[i+1][j+1];
                                // else
                                //     hahaha[i][j]=0;
                                nonono[i+1][j+1] = 0;
                            }
                        }
                    }


                   // paneltoscatter();
                    selectpaneltoscatter();

                 //   refreshscatter();
                    refreshpanel();//改变hahaha[]后 重绘


                };


                refreshpanel();  //down函数按下去后重绘

            };


            refreshpanel();


        }








</script>














</body>
</html>